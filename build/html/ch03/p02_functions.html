

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.2 函数 &mdash; pydata 0.1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.3 文件和操作系统" href="p03_files_and_the_opreating_system.html" />
    <link rel="prev" title="3.1 数据结构和序列" href="p01_data_structures_and_sequences.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> pydata
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../chapters/p03_build-in_data_structure_function_and_files.html">第三章：内建数据结构，函数和文件</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="p01_data_structures_and_sequences.html">3.1 数据结构和序列</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.2 函数</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">名字空间、作用域和局部函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">返回多个值</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">函数是对象</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lambda">匿名（Lambda）函数</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">部分参数应用</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">生成器</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">错误和异常处理</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="p03_files_and_the_opreating_system.html">3.3 文件和操作系统</a></li>
<li class="toctree-l2"><a class="reference internal" href="p04_conclusion.html">3.4 总结</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p04_numpy_basics_arrays_and_vectorized_computation.html">第四章：numpy基础：数组和向量化计算</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pydata</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../chapters/p03_build-in_data_structure_function_and_files.html">第三章：内建数据结构，函数和文件</a> &raquo;</li>
        
      <li>3.2 函数</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/ch03/p02_functions.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>3.2 函数<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>函数是python中初级的、最重要的代码组织和重用方式。
根据经验(as a rule of thumb)，如果你有预料要重复相同或相似的代码，写一个可重复使用的函数可能值得。
通过给代码块取一个名字，函数也可以增加你的代码可读性。</p>
<p>函数使用def关键字声明，从return关键字处返回:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">1.5</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">z</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">z</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>有多个return语句没有问题。
如果到达函数的结尾处还没有遇到(<strong>encounter</strong>)返回语句，python自动返回None。</p>
<p>每个函数可以有位置参数和关键字参数。
关键字参数常用来指定默认值或作为可选参数。
在前面的(<strong>preceding</strong>, adj)函数中，x和y是位置参数，z是关键参数。
这意味着函数可以用以下这些方式中任一种调用:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_function</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">my_function</span><span class="p">(</span><span class="mf">3.14</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)</span>
<span class="n">my_function</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<p>关于函数参数的主要限制在于位置参数必须要在关键字参数（如果有）前。
你可以用任意顺序指定关键字参数。
这将你从记忆函数参数位置中解放出来，仅仅需要记住参数的名字。</p>
<p>注：
也可以使用关键字参数代替位置参数。
在前面函数例子中，我们也可以这样写:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_function</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">my_function</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<p>在某些情况下这可以帮助增加代码可读性。</p>
<div class="section" id="id2">
<h2>名字空间、作用域和局部函数<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>函数在两种不同的作用域内可访问变量：全局和局部。
在python中，变量作用域更具描述力的名字叫名字空间。
任何在函数内被赋值的变量默认是局部名字空间。
局部名字空间在函数被调用时创建，立即由函数参数充填(<strong>populate</strong>).
在函数结束时，局部名字空间被释放（在本章范围(<strong>purview</strong>)外有一些例外）。
考虑下面函数:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
        <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<p>在func()被调用时，空列表a被创建，5个元素被追加进列表，在函数退出时a被释放。假如我们用如下的声明a:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<p>在函数作用域外赋值变量是可能的，但是要通过global关键字声明变量:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">168</span><span class="p">]:</span> <span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">169</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">bind_a_variable</span><span class="p">():</span>
<span class="o">.....</span><span class="p">:</span>          <span class="k">global</span> <span class="n">a</span>
<span class="o">.....</span><span class="p">:</span>          <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">.....</span><span class="p">:</span>  <span class="n">bind_a_variable</span><span class="p">()</span>
<span class="o">.....</span><span class="p">:</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">170</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="p">[]</span>
</pre></div>
</div>
<p>注意：
我一般不鼓励使用global关键字。全局变量在储存系统有些状态时使用比较典型。
如果你发现自己使用的比较多，你可能要考虑使用面向对象的编程（使用类）。</p>
</div>
<div class="section" id="id3">
<h2>返回多个值<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>当我使用过Java和C++后，第一次使用python编程时，我最喜爱的特性之一就是能够用一个简单的语法使函数返回多个值。这里有一个例子:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="p">()</span>
</pre></div>
</div>
<p>在数据分析和其它的科学应用中，你经常发现自己干这件事。
函数在这里实际上返回的是一个对象，叫元组，被解包到结果变量中去了。
在之前的例子中，我们可以这样做:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">return_value</span> <span class="o">=</span> <span class="n">f</span><span class="p">()</span>
</pre></div>
</div>
<p>在这种情况，return_value将是一个有三个返回变量的三元元组。
像以前，一个可能具有吸引力的代替方案是使用字典返回多个值:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span> <span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="p">:</span> <span class="n">b</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="p">:</span> <span class="n">c</span><span class="p">}</span>
</pre></div>
</div>
<p>这种替代方案是有用的，取决于你想尝试做什么。</p>
</div>
<div class="section" id="id4">
<h2>函数是对象<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>因为python函数是对象，所以在其他语言中难以表达的结构在Python中是比较容易表达的。
假如我们正在做数据清洗工作，需要对下列字符串列表进行一些列的变换:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">171</span><span class="p">]:</span> <span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; Alabama &#39;</span><span class="p">,</span> <span class="s1">&#39;Georgia!&#39;</span><span class="p">,</span> <span class="s1">&#39;Georgia&#39;</span><span class="p">,</span> <span class="s1">&#39;georgia&#39;</span><span class="p">,</span> <span class="s1">&#39;FlOrIda&#39;</span><span class="p">,</span>
<span class="o">.....</span><span class="p">:</span>  <span class="s1">&#39;south carolina##&#39;</span><span class="p">,</span> <span class="s1">&#39;West virginia?&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>任何处理过用户提交的调查数据都会见到这些凌乱的结果。
需要做很多事情来使这个字符串列表统一为分析做准备：移除空格，删除标点(<strong>punctuation</strong>)符号，并标准化适当的大小写。
做这件事的一种方式是使用内置的字符串方法以及(along with)re标准库模块的常用表达式:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">clean_strings</span><span class="p">(</span><span class="n">strings</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[!#?]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>结果像这样:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">173</span><span class="p">]:</span> <span class="n">clean_strings</span><span class="p">(</span><span class="n">states</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">173</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;Alabama&#39;</span><span class="p">,</span>
<span class="s1">&#39;Georgia&#39;</span><span class="p">,</span>
<span class="s1">&#39;Georgia&#39;</span><span class="p">,</span>
<span class="s1">&#39;Georgia&#39;</span><span class="p">,</span>
<span class="s1">&#39;Florida&#39;</span><span class="p">,</span>
<span class="s1">&#39;South Carolina&#39;</span><span class="p">,</span>
<span class="s1">&#39;West Virginia&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>一种有用的替代方法是生成一个操作列表，应用到具体的字符串集合:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">remove_punctuation</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[!#?]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<span class="n">clean_ops</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">,</span> <span class="n">remove_punctuation</span><span class="p">,</span> <span class="nb">str</span><span class="o">.</span><span class="n">title</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">clean_strings</span><span class="p">(</span><span class="n">strings</span><span class="p">,</span> <span class="n">ops</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">ops</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>结果如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">175</span><span class="p">]:</span> <span class="n">clean_strings</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">clean_ops</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">175</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39;Alabama&#39;</span><span class="p">,</span>
<span class="s1">&#39;Georgia&#39;</span><span class="p">,</span>
<span class="s1">&#39;Georgia&#39;</span><span class="p">,</span>
<span class="s1">&#39;Georgia&#39;</span><span class="p">,</span>
<span class="s1">&#39;Florida&#39;</span><span class="p">,</span>
<span class="s1">&#39;South Carolina&#39;</span><span class="p">,</span>
<span class="s1">&#39;West Virginia&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>像这样更具函数性模型使你能够在一个很高水平更简单地修改字符串变换方法。
clean_strings函数现在也更具可重用性和通用性(<strong>generic</strong>)。</p>
<p>你可以将函数作为其它函数的参数，如内置的map函数，对一个序列应用函数:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">176</span><span class="p">]:</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="n">remove_punctuation</span><span class="p">,</span> <span class="n">states</span><span class="p">):</span>
<span class="o">.....</span><span class="p">:</span>  <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">Alabama</span>
<span class="n">Georgia</span>
<span class="n">Georgia</span>
<span class="n">georgia</span>
<span class="n">FlOrIda</span>
<span class="n">south</span> <span class="n">carolina</span>
<span class="n">West</span> <span class="n">virginia</span>
</pre></div>
</div>
</div>
<div class="section" id="lambda">
<h2>匿名（Lambda）函数<a class="headerlink" href="#lambda" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id5">
<h2>部分参数应用<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id6">
<h2>生成器<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id7">
<h2>错误和异常处理<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="p03_files_and_the_opreating_system.html" class="btn btn-neutral float-right" title="3.3 文件和操作系统" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="p01_data_structures_and_sequences.html" class="btn btn-neutral" title="3.1 数据结构和序列" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, gfjiang.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1.0',
            LANGUAGE:'en',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>